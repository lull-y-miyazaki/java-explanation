# 3.1.2 【練習】ユーザーの作成とパスワード設定

この練習では、rootユーザーとして新しいユーザー「abe」を作成し、パスワードを設定します。

---

## ✅ 実行コマンド

```bash
# useradd abe
# passwd abe
```

---

## 🔍 各コマンドの意味

- `useradd abe`  
  → 新しいユーザー `abe` を作成します（ホームディレクトリやグループも作成されます）。

- `passwd abe`  
  → ユーザー `abe` にパスワードを設定します。コマンド実行後、2回パスワードの入力が求められます。

---

## ✅ 注意事項

- この操作は **rootユーザー権限** が必要です。一般ユーザーで実行する場合は `sudo` を使います。

```bash
$ sudo useradd abe
$ sudo passwd abe
```

- 作成されたユーザーは `/home/abe` にホームディレクトリが自動生成されます。

-----

# 3.1.3 【練習】ユーザー情報ファイルの確認

先ほど作成したユーザー `abe` の情報が、システムファイルに正しく記録されているかを確認します。

---

## ✅ 手順とコマンド

### 1. `/etc/passwd` ファイルを参照し、`abe` ユーザーが記述されていることを確認

```bash
# tail /etc/passwd
```

- `/etc/passwd` ファイルには、すべてのユーザーの情報が記録されています。
- 行末に `abe` ユーザーの情報が追加されているはずです。
- 各行の構成は以下のとおりです：  
  ```
  ユーザー名:パスワード（x）:UID:GID:コメント:ホームディレクトリ:ログインシェル
  ```

---

### 2. `/etc/shadow` ファイルを参照し、パスワード情報が記録されていることを確認

```bash
# cat /etc/shadow
```

- `/etc/shadow` ファイルには、各ユーザーのパスワードのハッシュや有効期限などの情報が記録されています。
- `abe` ユーザーの行に、暗号化された文字列が2番目の欄に表示されます。

---

## 🔍 注意事項

- `/etc/shadow` は機密性の高いファイルです。表示には **root権限** が必要です。
- 読み取れるのは `root` ユーザーか、特別なアクセス権を持つプログラムのみです。

---

## ✅ 補足コマンド（任意）

```bash
# grep abe /etc/passwd
# grep abe /etc/shadow
```

- `abe` ユーザーの行だけを抽出して確認できます。

-----

# 3.1.4 【練習】ユーザーID（UID）を指定したユーザー作成と確認

この練習では、ユーザー作成時にUID（ユーザーID）を指定する方法と、作成されたユーザーの確認方法を学びます。

---

## ✅ 手順とコマンド

### 1. ユーザー `tanaka` を UID=2000 で作成する

```bash
# useradd -u 2000 tanaka
```

- `-u` オプションを使うことで、任意の UID を指定できます。

---

### 2. `/etc/passwd` ファイルで `tanaka` のエントリを確認する

```bash
# tail /etc/passwd
```

または、対象ユーザーを直接検索：

```bash
# grep tanaka /etc/passwd
```

- 該当行の 3 番目のフィールドが UID です。  
  例：`tanaka:x:2000:2000:...`

---

### 3. ユーザー `yoshida` を追加する

```bash
# useradd yoshida
```

- UIDは自動的に次の利用可能な番号が割り当てられます。

---

### 4. `yoshida` のユーザーID（UID）を確認する

```bash
# id yoshida
```

- または `/etc/passwd` ファイルを使って確認：

```bash
# grep yoshida /etc/passwd
```

---

## 🔍 補足

- UID（ユーザーID）は、システムがユーザーを識別するための内部番号です。
- `/etc/passwd` はすべてのユーザーの基本情報を管理しています。
- UIDの重複は避ける必要があります。特に1000未満はシステム用に予約されています。

------

# 3.1.5 【練習】ユーザー作成時にホームディレクトリを指定する

この練習では、`useradd` コマンドでユーザー `sato` を作成する際に、ホームディレクトリを指定し、作成内容を確認します。

---

## ✅ 手順とコマンド

### 1. ユーザー `sato` のホームディレクトリを `/home/dir` に指定して作成する

```bash
# useradd -d /home/dir -m sato
```

- `-d /home/dir`：ホームディレクトリのパスを指定
- `-m`：指定されたホームディレクトリを作成するオプション

---

### 2. `/etc/passwd` ファイルを確認し、`sato` のホームディレクトリが正しく設定されているか確認

```bash
# grep sato /etc/passwd
```

- 出力の6番目のフィールドがホームディレクトリ
  - 例：`sato:x:1001:1001::/home/dir:/bin/bash`

---

### 3. `/home` ディレクトリ内に `dir` ディレクトリが作成されていることを確認

```bash
# ls /home
```

- `dir` ディレクトリが表示されていれば、正しく作成されています。

---

## 🔍 補足

- `useradd` の `-d` はホームディレクトリのカスタム設定に使用。
- `-m` を省略すると、指定したホームディレクトリは作成されません。
- ユーザーごとの情報は `/etc/passwd` に記録され、ホームディレクトリやログインシェル情報も含まれます。

-----

# 3.1.6 【練習】ユーザー削除とホームディレクトリの確認

この練習では、ユーザーを削除したときにホームディレクトリが残るかどうかを確認し、`-r` オプションの効果を理解します。

---

## ✅ 練習①：ユーザー `tanaka` を削除し、ホームディレクトリが残ることを確認

### 1. ユーザー `tanaka` を削除する

```bash
# userdel tanaka
```

### 2. `/home/tanaka` ディレクトリが残っていることを確認する

```bash
# ls /home
```

- 通常 `userdel` だけではユーザーのホームディレクトリは削除されません。
- ディレクトリ名（`tanaka`）が残っているはずです。

---

### ✅ ホームディレクトリも含めて削除するには？

```bash
userdel -r <ユーザ名>
```

- `-r` オプションをつけることで、ホームディレクトリやメールスプールも一緒に削除されます。

---

## ✅ 練習②：ユーザー `sato` をホームディレクトリごと削除

### 1. ユーザー `sato` をホームディレクトリごと削除する

```bash
# userdel -r sato
```

---

### 2. `/home/dir` が削除されていることを確認

```bash
# ls /home
```

- `sato` のホームディレクトリ `/home/dir` が削除されていることを確認します。

---

## 🔍 補足

- `userdel`：ユーザーを削除
- `-r`：ホームディレクトリとメールスプールも削除
- `/etc/passwd` や `/etc/shadow` からも情報は削除されます

**注意：`-r` を使うとデータが完全に削除されるため、誤操作に注意してください。**

-----

# 3.1.7 【練習】グループの作成

Linuxの `groupadd` コマンドを使って、指定された名前のグループを作成する練習です。

---

## ✅ 手順とコマンド

### 1. `eigyo` という名前のグループを作成

```bash
# groupadd eigyo
```

---

### 2. `keiri` という名前のグループを作成

```bash
# groupadd keiri
```

---

### 3. `somu` という名前のグループを作成

```bash
# groupadd somu
```

---

## 🔍 補足

- `groupadd` コマンドは、新しいグループをシステムに追加するためのコマンドです。
- 作成されたグループの情報は `/etc/group` に記録されます。
- 登録されていることを確認するには以下のコマンドを使用します：

```bash
# grep eigyo /etc/group
# grep keiri /etc/group
# grep somu /etc/group
```

-----

# 3.1.8 【練習】usermod コマンドによるグループの変更と確認

この練習では、ユーザーの**プライマリグループ**および**サブグループ（補助グループ）**の設定を行います。

---

## ✅ 手順とコマンド

### 1. ユーザ `sato` のプライマリグループを `eigyo` に指定する

```bash
# usermod -g eigyo sato
```

- `-g`：プライマリグループの変更
- `eigyo` グループが存在している必要があります

---

### 2. `/etc/passwd` ファイルを参照して、`sato` のプライマリグループが `eigyo` になっていることを確認

```bash
# grep sato /etc/passwd
```

- `/etc/group` ファイルでグループ情報も確認できます。

---

## ✅ 解説：グループを変更するコマンドの構文

```bash
usermod -g <プライマリグループ> -G <サブグループ> <ユーザ名>
```

- `-g`：プライマリグループを指定
- `-G`：サブグループをカンマ区切りで複数指定可能

---

## ✅ 練習：コマンドの意味を確認

```bash
# usermod -g keiri -G eigyo,somu sato
```

### 🔍 このコマンドの意味：
- ユーザー `sato` のプライマリグループを `keiri` に変更
- サブグループとして `eigyo` と `somu` を設定

---

## 🔎 補足

- グループの変更後は、`id sato` で所属グループを確認できます。
- 変更は次回ログイン以降に反映されることがあります。

```bash
# id sato
```

出力例：
```
uid=1001(sato) gid=1002(keiri) groups=1002(keiri),1003(eigyo),1004(somu)
```

-----

# 3.1.9 【練習】プライマリグループが存在する場合のグループ削除制限の確認

この練習では、グループがユーザーに使われている間は削除できないことを確認し、ユーザー削除後にグループを削除できることを実践します。

---

## ✅ 手順とコマンド

### 1. `somu` グループをプライマリグループとするユーザー `kato` を作成する

```bash
# useradd -g somu kato
```

- `-g somu`：`somu` をプライマリグループとして指定
- 事前に `somu` グループが存在している必要があります

---

### 2. `somu` グループが削除できないことを確認する

```bash
# groupdel somu
```

- ❌ 削除できない場合、次のようなエラーが出力されます：

```
groupdel: グループ 'somu' はまだ他のユーザーによって使われています
```

---

### 3. ユーザー `kato` を削除する

```bash
# userdel kato
```

- ホームディレクトリも削除したい場合は：

```bash
# userdel -r kato
```

---

### 4. `somu` グループを削除できることを確認する

```bash
# groupdel somu
```

- ✅ 今回は正常に削除できるはずです。

---

## 🔍 補足

- **グループは使用中のユーザーがいると削除できない**
- **`/etc/group`** に登録されているグループ情報を確認可能
- 状態確認には以下のコマンドも便利：

```bash
# grep somu /etc/group
# id kato
```